<html>
    <head>
        <title>Webern Website</title>
        <script src="https://www.verovio.org/javascript/develop/verovio-toolkit.js" type="text/javascript" ></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript" ></script>
        <script src="../javascript/basic-events.js" type="text/javascript" ></script>
        <link rel="stylesheet" href="../css/tutorial.css" />
    </head>
    <body style="margin: 0px;">

        <div id="help_overlay">
            <p><big>Webern: Symphonie op.21, movement 1, opening</big></p>
            <br/>
            <p>This opening section is a double canon in inversion.</p>
            <p><font color="red"> Press <b>1</b> to show the first part (dux) of the first canon in red.</font></p>
            <p><font color="green"> Press <b>2</b> to show the second part (comes) of the first canon in green.</font></p>
            <p><font color="blue"> <p>Press <b>3</b> to show the first part (dux) of the second canon in blue.</font></p>
            <p><font color="orange"> <p>Press <b>4</b> to show the second part (comes) of the second canon in orange.</font></p>
            <br/>
            <p>Throughout, the instruments are paired: clarinet and bass clarinet; the two horns; the two hands (staves) of the harp; Vln1 with viola; Vln1 with VC.</p>
            <p>Corresponding material appears in those matching parts.</p>
            <p><font color="red"> <p>Press any of <b>5, 6, 7, 8, 9</b> to show blocks of that material (in their original colours) in the first canon.</font></p>
            <br/>
            <p>Each pitch class consistently appears in the same octave, for instance, A always sounds as 'A3', just below middle C.</p>
            <p>The exceptional pitch class is Eb which appears as both Eb3 and Eb4 (either side of the A3).</p>
            <p>This is part of a symmetrical pattern of pitches centred on that A3.</p>
            <p>A and Eb have a special, central role for other reasons, for instance, they're the only pitches to be simultaneously by the same instrument.</p>
            <p><font color="purple"> Press <b>0</b> to show each A and Eb in this passage in all parts.</font></p>
        </div>

        <div id="svg_output"/>

        <script type="text/javascript">
            var vrvToolkit = new verovio.toolkit();
            var page = 1;
            var zoom = 50;
            var pageHeight = 2970;
            var pageWidth = 2100;


            /* A highlighting choice */

            var choice = 1;

            function setOptions( ) {
                pageHeight = $(document).height() * 100 / zoom ;
                pageWidth = $(window).width() * 100 / zoom ;
                options = {
                            pageHeight: pageHeight,
                            pageWidth: pageWidth,
                            scale: zoom,
                            adjustPageHeight: 1,
                            ignoreLayout: 1
                        };
                vrvToolkit.setOptions( options );
            }

            function loadData(data) {
                setOptions();
                vrvToolkit.loadData(data);

                page = 1;
                loadPage();
            }

            /* Load the page and highlight according to the current choice */

            function loadPage() {
                svg = vrvToolkit.renderPage(page, {});
                $("#svg_output").html(svg);

                if (choice == 1) {

                    // var info = [
                    //     {gt : 4, lt : 3, child : 1},
                    //     {gt : 7, lt: 5, child :10},
                    //     {gt : 12, lt : 4, child : 1},
                    //     {gt: 16, lt : 3, child: 4},
                    // ]
                    //
                    // for (const el of info) {
                    //     $(".system .measure:gt(+"el.gt"+):lt(+"el.gt"+) .staff:nth-child("el.child") .note").attr("fill", "#d00").attr("stroke", "#d00");
                    // }

                    $(".system .measure:lt(4) .staff:nth-child(4) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(4):lt(3) .staff:nth-child(1) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(7):lt(5) .staff:nth-child(10) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(12):lt(4) .staff:nth-child(1) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(16):lt(3) .staff:nth-child(4) .note").attr("fill", "#d00").attr("stroke", "#d00");

                }
                else if (choice == 2) {
                    $(".system .measure:gt(1):lt(4) .staff:nth-child(3) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                    $(".system .measure:gt(6):lt(3) .staff:nth-child(2) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                    $(".system .measure:gt(9):lt(5) .staff:nth-child(9) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                    $(".system .measure:gt(14):lt(4) .staff:nth-child(2) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                    $(".system .measure:gt(18):lt(3) .staff:nth-child(3) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 5) {
                    $(".system .measure:lt(4) .staff:nth-child(4) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(1):lt(4) .staff:nth-child(3) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 6) {
                    $(".system .measure:gt(4):lt(3) .staff:nth-child(1) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(6):lt(3) .staff:nth-child(2) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 7) {
                    $(".system .measure:gt(7):lt(5) .staff:nth-child(10) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(9):lt(5) .staff:nth-child(9) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 8) {
                    $(".system .measure:gt(12):lt(4) .staff:nth-child(1) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(14):lt(4) .staff:nth-child(2) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 9) {
                    $(".system .measure:gt(16):lt(3) .staff:nth-child(4) .note").attr("fill", "#d00").attr("stroke", "#d00");
                    $(".system .measure:gt(18):lt(3) .staff:nth-child(3) .note").attr("fill", "#0c0").attr("stroke", "#0c0");
                }
                else if (choice == 3) {
                    $(".system .measure:gt(0):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(1):lt(3) .staff:nth-child(10) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(4):lt(1) .staff:nth-child(8) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(5):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(6):lt(1) .staff:nth-child(5) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(7):lt(2) .staff:nth-child(4) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(9):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(10):lt(1) .staff:nth-child(5) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(10):lt(2) .staff:nth-child(4) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(12):lt(2) .staff:nth-child(7) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(14):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(14):lt(2) .staff:nth-child(9) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(15):lt(2) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(16):lt(3) .staff:nth-child(9) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(18):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(19):lt(2) .staff:nth-child(9) .note").attr("fill", "#00e").attr("stroke", "#00e");
                    $(".system .measure:gt(21):lt(1) .staff:nth-child(6) .note").attr("fill", "#00e").attr("stroke", "#00e");
                }
                else if (choice == 4) {
                    $(".system .measure:gt(2):lt(1) .staff:nth-child(6) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(3):lt(3) .staff:nth-child(9) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(6):lt(1) .staff:nth-child(7) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(7):lt(1) .staff:nth-child(6) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(8):lt(1) .staff:nth-child(6) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(9):lt(2) .staff:nth-child(3) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(11):lt(1) .staff:nth-child(5) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(12):lt(1) .staff:nth-child(6) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(12):lt(2) .staff:nth-child(3) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(14):lt(2) .staff:nth-child(10) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(16):lt(1) .staff:nth-child(5) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(16):lt(2) .staff:nth-child(8) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(17):lt(2) .staff:nth-child(5) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(18):lt(3) .staff:nth-child(10) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(20):lt(1) .staff:nth-child(5) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(21):lt(2) .staff:nth-child(10) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(23):lt(1) .staff:nth-child(5) .note").attr("fill", "#d70").attr("stroke", "#d70");
                    $(".system .measure:gt(23):lt(1) .staff:nth-child(6) .note").attr("fill", "#d70").attr("stroke", "#d70");
                }
                else if (choice === 0) {

                $(".note").each(function(i) {
                    var attr = vrvToolkit.getElementAttr($(this).attr("id"));
                    if (attr.pname && (attr.pname == "a") {
                        $(this).attr("fill", "purple").attr("stroke", "purple");
                    }
                    });
                }
                else {
                    console.log("Unknown choice");
                }
            }

            $( document ).ready(function() {

                $(window).keyup(function(event){

                    /* Process navigation and zoom basic events */
                    processBasicEvents(event);


                    /* Key events for switching highlight choice */
                    if ((event.keyCode > 47) && (event.keyCode < 58)) {
                        choice = event.keyCode - 48;
                        loadPage();
                    }
                });

                $(window).resize(function(){
                    applyZoom();
                });

                var file = "Webern-Symphonie.mei";
                $.ajax({
                    url: file
                    , dataType: "text"
                    , success: function(data) {
                        loadData( data );
                    }
                });
            });
        </script>
    </body>
</html>
